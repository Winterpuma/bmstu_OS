# Вопросы по лабе: 

1. В каком порядке загружаются модули? 
    - Сначала загружается модуль, экспортирующий данные. Затем модуль, использующий данные. 
2. Вы пробовали использовать вместо md1_proc md1_local и md1_noexport? Какие при этом возникают ошибки?
    - При md1_local проект не компилируется. Возникает ошибка implicit declaration of function ‘md1_local’.
    - При md1_noexport проект компилируется(Если он прописан в .h файле). Возникает ошибка при попытке загрузить модуль. Ошибка insmod: ERROR: could not insert module md2.ko: Unknown symbol in module
3. В каком порядке должны быть выгружены модули? Почему?
    - Сначала должен быть выгружен модуль, использующий данные. Затем модуль, экспортирующий данные.
    - Из Цирюлика:
    > На модуль md1 ссылается некоторые другие модули или объекты ядра: цифра 1 — это число таких ссылающихся модулей, которое называется счётчиком ссылок;
    > Дальше за счётчиком ссылок указывается список тех модулей, откуда исходят такие ссылки, в данном случае, это один модуль md2;
    >  До тех пор, пока число ссылок на любой модуль в системе не станет нулевым, модуль не может быть выгружен;
    > Другими словами, модуль может быть выгружен только после того, как будут выгружены все ссылающиеся на него другие модули (загруженные после него — здесь не может возникнуть цикличности или перекрёстности ссылок);
    >  Бывают случаи (как будет показано дальше), когда модуль вообще не может быть выгружен, в частности, когда счётчик ссылок для модуля не может быть сделан нулевым в силу каких-то причин.
 
3. Что получает второй(использующий данные) модуль по имени экспортируемых данных? Что получает, чтобы обращаться к данным? 
    - абсолютный адрес
    - Из Цирюлика:

    >  Модуль md1 экспортирует для использования другими модулями имя процедуры md1_proc() и, что далеко не так очевидно, имя структуры данных md1_data. Любой другой модуль (md2) может использовать в своём коде любые экспортируемые имена. Это могут быть имена, экспортируемые ранее загруженными модулями, но гораздо чаще это имена, экспортируемые ядром. Это множество экспортируемых имён ядра далее будет называться API ядра. Примером одного из вызовов из набора API ядра в показанных фрагментах кода является вызов printk().
    >  Модуль md2, использующий экспортируемое имя, связывается с этим именем по прямому абсолютному адресу. Как следствие этого, любые изменения (новая сборка), вносимые в ядро или экспортирующие модули, делают собранный модуль непригодным для использования. Именно поэтому бессмысленно предоставлять модуль в собранном виде — он должен собираться только на месте использования.

4. Что такое абсолютный адрес? Что такое относительный?
    - абсолютный адрес - это реальный физический адрес ячейки памяти
    - относительный адрес может быть представлен как сегмент:смешение, через страницы и тд
5. Какой командой можно проверить, что модули загружены в систему?
    - lsmod 
    - lsmod | grep md
    - md2 ссылается на md1 
6. Покажите, что модули загружены в ситсему. 
    - lsmod | grep md
7. Почему третий модуль не загружен в систему?
    - Так как он возвращает -1.
    >    Функция инициализации этого модуля, выполнив все предписанные ей действия, преднамеренно возвращает ненулевое значение, что означает ошибку инициализации модуля;
    > Тогда такой модуль не будет подгружен к ядру, но произойдёт это уже после выполнения кода инициализирующей функции модуля в пространстве ядра;
    >  А если такой модуль по замыслу не загружается, то он, в принципе, может не иметь функции выгрузки.
